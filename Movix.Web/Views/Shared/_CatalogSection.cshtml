@model Movix.Web.Models.CatalogPageVm
@{
    var f = Model.Filter;
    var result = Model.PageResult!;
    var totalPages = Math.Max(1, (int)Math.Ceiling((double)result.Total / Math.Max(1, result.PageSize)));
}

<h2 class="mb-3">Catálogo</h2>

<form id="catalogForm" method="get" action="@Url.Action("Index","Home")"
      class="row gy-2 gx-2 align-items-end mb-3">
    <input type="hidden" name="Page" value="1" />
    <input type="hidden" name="GeneroId" value="@(f.GeneroId?.ToString() ?? "")" />
    <input type="hidden" name="section" value="genres" />

    <div class="col-sm-3">
        <label class="form-label">Classificação</label>
        <select name="ClassificacaoId" class="form-select">
            <option value="">Todas</option>
            @foreach (var c in Model.Classificacoes)
            {
                if (f.ClassificacaoId == c.Id)
                {
                    <option value="@c.Id" selected>@c.Nome</option>
                }
                else
                {
                    <option value="@c.Id">@c.Nome</option>
                }
            }
        </select>
    </div>

    <div class="col-sm-2">
        <label class="form-label">Ano</label>
        <input type="number" name="Ano" class="form-control" value="@(f.Ano?.ToString() ?? "")" />
    </div>

    <div class="col-sm-4">
        <label class="form-label">Busca</label>
        <input type="text" name="Q" class="form-control" value="@f.Q" placeholder="título ou sinopse..." />
    </div>

    <div class="col-sm-2">
        <label class="form-label">Ordenar</label>
        <select name="SortBy" class="form-select">
            @if (f.SortBy == "CreatedAt")
            {
                <option value="CreatedAt" selected>Recentes</option>
            }
            else
            {
                <option value="CreatedAt">Recentes</option>
            }
            @if (f.SortBy == "Titulo")
            {
                <option value="Titulo" selected>Título</option>
            }
            else
            {
                <option value="Titulo">Título</option>
            }
            @if (f.SortBy == "Ano")
            {
                <option value="Ano" selected>Ano</option>
            }
            else
            {
                <option value="Ano">Ano</option>
            }
        </select>
    </div>

    <div class="col-sm-1">
        <label class="form-label">Desc</label><br />
        @if (f.Desc)
        {
            <input type="checkbox" name="Desc" class="form-check-input" value="true" checked />
        }
        else
        {
            <input type="checkbox" name="Desc" class="form-check-input" value="true" />
        }
    </div>

    <div class="col-sm-2">
        <label class="form-label">Itens/página</label>
        <select name="PageSize" class="form-select">
            @foreach (var s in new[] { 12, 24, 36, 48 })
            {
                if (f.PageSize == s)
                {
                    <option value="@s" selected>@s</option>
                }
                else
                {
                    <option value="@s">@s</option>
                }
            }
        </select>
    </div>

    <div class="col-sm-12">
        <button type="submit" class="btn btn-primary">Aplicar filtros</button>
        <a class="btn btn-secondary ms-2" href="/?section=genres">Limpar</a>
    </div>
</form>

@* -*------------------------------------------: *@

<nav class="mt-4" aria-label="Paginação">
    <ul class="pagination">
        <li class="page-item @(f.Page<=1 ? "disabled" : "")">
            <a class="page-link" href="@Url.Action("Index", new {
        GeneroId=f.GeneroId, ClassificacaoId=f.ClassificacaoId, Ano=f.Ano, Q=f.Q,
        SortBy=f.SortBy, Desc=f.Desc, Page=1, PageSize=f.PageSize, section="genres" })">&laquo;</a>
        </li>
        <li class="page-item @(f.Page<=1 ? "disabled" : "")">
            <a class="page-link" href="@Url.Action("Index", new {
        GeneroId=f.GeneroId, ClassificacaoId=f.ClassificacaoId, Ano=f.Ano, Q=f.Q,
        SortBy=f.SortBy, Desc=f.Desc, Page=f.Page-1, PageSize=f.PageSize, section="genres" })">Anterior</a>
        </li>
        <li class="page-item disabled">
            <span class="page-link">
                Página @f.Page de @totalPages
                <span class="badge text-bg-secondary ms-2">total: @result.Total</span>
            </span>
        </li>
        <li class="page-item @(f.Page>=totalPages ? "disabled" : "")">
            <a class="page-link" href="@Url.Action("Index", new {
        GeneroId=f.GeneroId, ClassificacaoId=f.ClassificacaoId, Ano=f.Ano, Q=f.Q,
        SortBy=f.SortBy, Desc=f.Desc, Page=f.Page+1, PageSize=f.PageSize, section="genres" })">Próxima</a>
        </li>
        <li class="page-item @(f.Page>=totalPages ? "disabled" : "")">
            <a class="page-link" href="@Url.Action("Index", new {
        GeneroId=f.GeneroId, ClassificacaoId=f.ClassificacaoId, Ano=f.Ano, Q=f.Q,
        SortBy=f.SortBy, Desc=f.Desc, Page=totalPages, PageSize=f.PageSize, section="genres" })">&raquo;</a>
        </li>
    </ul>
</nav>
