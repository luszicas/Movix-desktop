


<link href="~/css/site.css" rel="stylesheet" />

@{
    ViewData["Title"] = "Dashboard (Admin)";

    var porRole =
        (ViewBag.PorRole as Dictionary<string, int>)
        ?? (ViewBag.UsuariosPorRole as Dictionary<string, int>)
        ?? new Dictionary<string, int>();

    var ultimos =
        ViewBag.Ultimos as List<Movix.Web.Areas.Admin.Services.UltimoFilmeItem>
        ?? new List<Movix.Web.Areas.Admin.Services.UltimoFilmeItem>();
}

<div class="container" style="padding-top: 140px;">

    <!-- Cabeçalho -->
    <div class="d-flex justify-content-between align-items-end mb-4 border-bottom border-secondary pb-3">
        <div>
            <h6 class="text-uppercase text-info fw-bold mb-1" style="letter-spacing: 2px;">
                Administração
            </h6>
            <h1 class="fw-bold text-white mb-0">Painel de Controle</h1>
            <p class="text-secondary mt-2 mb-0">Visão geral do sistema e estatísticas.</p>
        </div>

        <a asp-area="Admin" asp-controller="Manage" asp-action="Index"
           class="btn btn-outline-light shadow px-4 py-2 rounded-3">
            <i class="bi bi-gear-fill me-2"></i> Central de Gestão
        </a>
    </div>


    <!-- Cards de estatísticas -->
    <div class="row g-4">

        <div class="col-md-3">
            <div class="card bg-dark text-light border-0 shadow-lg stat-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-secondary small">Total de Filmes</span>
                        <i class="bi bi-film text-info fs-4"></i>
                    </div>
                    <div class="display-6 fw-bold">@ViewBag.TotalFilmes</div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card bg-dark text-light border-0 shadow-lg stat-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-secondary small">Total de Gêneros</span>
                        <i class="bi bi-tags-fill text-warning fs-4"></i>
                    </div>
                    <div class="display-6 fw-bold">@ViewBag.TotalGeneros</div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card bg-dark text-light border-0 shadow-lg stat-card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-secondary small">Total de Usuários</span>
                        <i class="bi bi-people-fill text-success fs-4"></i>
                    </div>
                    <div class="display-6 fw-bold">@ViewBag.TotalUsuarios</div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card bg-dark text-light border-0 shadow-lg stat-card">
                <div class="card-body">
                    <span class="text-secondary small d-block mb-2">Usuários por Perfil</span>

                    @if (porRole.Any())
                    {
                        @foreach (var kv in porRole)
                        {
                            <div class="d-flex justify-content-between border-bottom border-secondary py-1 small">
                                <span>@kv.Key</span>
                                <span class="fw-bold">@kv.Value</span>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="text-muted small fst-italic">Nenhum usuário encontrado.</div>
                    }
                </div>
            </div>
        </div>

    </div>


    <!-- Charts -->
    <div class="row g-4 mt-4">
        <div class="col-lg-6">
            <div class="card bg-dark text-light border-0 shadow-lg rounded-4">
                <div class="card-body">
                    <h5 class="fw-bold text-info mb-3">Filmes por Gênero</h5>
                    <canvas id="chartGenero"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card bg-dark text-light border-0 shadow-lg rounded-4">
                <div class="card-body">
                    <h5 class="fw-bold text-info mb-3">Filmes por Classificação</h5>
                    <canvas id="chartClass"></canvas>
                </div>
            </div>
        </div>
    </div>


    <div class="row g-4 mt-4">

        <div class="col-lg-8">
            <div class="card bg-dark text-light border-0 shadow-lg rounded-4">
                <div class="card-body">
                    <h5 class="fw-bold text-info mb-3">Filmes por Ano</h5>
                    <canvas id="chartAno"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card bg-dark text-light border-0 shadow-lg rounded-4 h-100">
                <div class="card-body">
                    <h5 class="fw-bold text-info mb-3">Últimos Filmes</h5>

                    @if (ultimos.Any())
                    {
                        <ul class="list-unstyled mb-0">
                            @foreach (var f in ultimos)
                            {
                                <li class="mb-3 bg-secondary bg-opacity-10 p-2 rounded-3">
                                    <div class="fw-bold text-white">@f.Titulo</div>
                                    <div class="text-secondary small">
                                        @f.Genero · @f.Classificacao · @f.Ano
                                    </div>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <div class="text-muted small fst-italic">Nenhum filme cadastrado.</div>
                    }
                </div>
            </div>
        </div>

    </div>

</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/dashboard.js" asp-append-version="true"></script>
}

<style>
    .stat-card {
        transition: 0.2s;
        border: 1px solid transparent;
    }

        .stat-card:hover {
            transform: translateY(-3px);
            border-color: rgba(0, 200, 255, 0.3);
            box-shadow: 0 0 15px rgba(0, 200, 255, 0.1);
        }

    .btn-outline-light:hover,
    .btn-outline-light:hover i {
        color: black !important;
    }


</style>
